{% extends 'layouts/root-dashboard.html' %}

<!-- body -->
{% block body %}
<header class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
	<a class="navbar-brand col-md-3 col-lg-2 me-0 px-3 fs-6" href="#">
		{{ shopname }}
	</a>
	<button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-bs-toggle="collapse"
		data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
		<span class="navbar-toggler-icon"> </span>
	</button>
	<input class="form-control form-control-dark w-100 rounded-0 border-0" type="text" placeholder="Search"
		aria-label="Search" disabled />
	<div class="navbar-nav">
		<div class="nav-item text-nowrap">
			<a class="nav-link px-3" href="{{ url_for('dashboard.user_logout') }}">Sign out </a>
		</div>
	</div>
</header>

<div class="container-fluid">
	<div class="row">
		<!-- navigation inject -->
		{% include 'helpers/_dashboard_side_nav.html' %}

		<main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
			{% if current_user.user_role != 'employee' %}
			<div
				class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
				<h1 class="h2">Employees</h1>
				<div class="btn-toolbar mb-2 mb-md-0">
					<div class="btn-group me-2">
						<button type="button" class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal"
							data-bs-target="#employeeModal">
							<i class="bx bx-plus"></i>
							Add New Employee
						</button>
					</div>
				</div>
			</div>

			<!-- add products modal -->
			<div class="modal fade" id="employeeModal" tabindex="-1" aria-labelledby="employeeModalLabel"
				aria-hidden="true">
				<form method="POST" action="">
					{{ form.hidden_tag() }}
					<div class="modal-dialog modal-lg" role="document">
						<div class="modal-content rounded-4 shadow">
							<div class="modal-header border-bottom-0">
								<h5 class="modal-title" id="exampleModalLabel">
									Add New Employee
								</h5>

								<button type="button" class="btn-close" data-bs-dismiss="modal"
									aria-label="Close"></button>
							</div>

							<div class="modal-body py-0">
								<div class="row">
									<div class="col-md-12">
										<!-- USERNAME -->
										<div class="form-floating mb-3">
											{% if form.username.errors %}
											{{ form.username(
												class="form-control is-invalid",
												placeholder="Username"
											) }}
											<div class="invalid-feedback">
												{% for error in form.username.errors %}
												<span>{{ error }}</span>
												{% endfor %}
											</div>
											{% else %}
											{{ form.username(
												class="form-control",
												placeholder="Username"
											) }}
											{% endif %}

											{{ form.username.label() }}
										</div>
									</div>
								</div>
								<div class="row">
									<div class="col-md-6">
										<!-- PHONE NUMBER -->
										<div class="form-floating mb-3">
											{% if form.phone.errors %}
											{{ form.phone(
												class="form-control is-invalid",
												placeholder="Phone number"
											) }}
											<div class="invalid-feedback">
												{% for error in form.phone.errors %}
												<span>{{ error }}</span>
												{% endfor %}
											</div>
											{% else %}
											{{ form.phone(
												class="form-control",
												placeholder="Phone number"
											) }}
											{% endif %}

											{{ form.phone.label() }}
										</div>
									</div>
									<div class="col-md-6">
										<!-- EMAIL -->
										<div class="form-floating mb-3">
											{% if form.email.errors %}
											{{ form.email(
												class="form-control is-invalid",
												placeholder="Email"
											) }}
											<div class="invalid-feedback">
												{% for error in form.email.errors %}
												<span>{{ error }}</span>
												{% endfor %}
											</div>
											{% else %}
											{{ form.email(
												class="form-control",
												placeholder="Email"
											) }}
											{% endif %}

											{{ form.email.label() }}
										</div>
									</div>
								</div>

								<div class="row">
									<div class="col-md-6">
										<!-- PASSWORD -->
										<div class="form-floating mb-3">
											{% if form.password.errors %}
											{{ form.password(
												class="form-control is-invalid",
												placeholder="Password"
											) }}
											<div class="invalid-feedback">
												{% for error in form.password.errors %}
												<span>{{ error }}</span>
												{% endfor %}
											</div>
											{% else %}
											{{ form.password(
												class="form-control",
												placeholder="Password"
											) }}
											{% endif %}

											{{ form.password.label() }}
										</div>
									</div>
									<div class="col-md-6">
										<!-- CONFIRM PASSWORD -->
										<div class="form-floating mb-3">
											{% if form.confirm_password.errors %}
											{{ form.confirm_password(
												class="form-control is-invalid",
												placeholder="Confirm Password"
											) }}
											<div class="invalid-feedback">
												{% for error in form.confirm_password.errors %}
												<span>{{ error }}</span>
												{% endfor %}
											</div>
											{% else %}
											{{ form.confirm_password(
												class="form-control",
												placeholder="Confirm Password"
											) }}
											{% endif %}

											{{ form.confirm_password.label() }}
										</div>
									</div>
								</div>

								<div class="mb-5">
                                    <input type="checkbox" id="show-password">
                                    <label for="show-password">Show Password</label>
                                </div>

								<script>
									const checkbox = document.getElementById("show-password");
									const passwordFields = document.querySelectorAll('input[type="password"]');

									checkbox.addEventListener('change', function () {
										if (this.checked) {
											passwordFields.forEach(field => field.type = 'text');
										} else {
											passwordFields.forEach(field => field.type = 'password');
										}
									});

								</script>
							</div>

							<div class="modal-footer">
								{{ form.submit(class="btn btn-lg btn-primary w-100 mx-0 mb-2") }}
							</div>
						</div>
					</div>
				</form>
			</div>
			<!-- end of add product modal -->

			<!-- SUMMERY OF BRAND -->
			<div class="container">
				<div class="row gap-2 mb-5">
					<div class="col-lg-3">
						<div class="border summery__box bg__anakiwa p-2">
							<h3 class="summery__box-title fs-1 fw-bolder">
								{{ employees|length }}
							</h3>
							<p class="summery__subtitle">Total Employee</p>
						</div>
					</div>
				</div>
			</div>

			<!-- BRAND DETAILS -->
			<h2>All Employee</h2>
			<hr />
			{% if employees %}
			<div class="table-responsive">
				<table class="table table-striped table-sm">
					<thead>
						<tr>
							<th scope="col" width="100">#</th>
							<th scope="col">Username</th>
							<th scope="col">Phone</th>
							<th scope="col">Email</th>
							<th scope="col">Action</th>
						</tr>
					</thead>
					<tbody>
						{% for employee in employees %}
						<tr class="align-middle">
							<td class="text-center counters">{{ employee.id }}</td>
							<td>{{ employee.username }}</td>
							<td>{{ employee.phone }}</td>
							<td>{{ employee.email }}</td>
							<td>
								<div class="btn-group dropstart">
									<button type="button" class="btn btn-dark btn-sm dropdown-toggle"
										data-bs-toggle="dropdown" aria-expanded="false">
										More Option
									</button>
									<ul class="dropdown-menu bg-gradient bg-info">
										<li>
											<a href="{{ url_for('dashboard.employee_profile_edit', employee_id=employee.id) }}"
												class="dropdown-item">
												Edit info
											</a>
										</li>
										<li>
											<a href="#" class="dropdown-item bg-danger text-white"
												data-bs-toggle="modal"
												data-bs-target="#deleteEmployeeModal{{employee.id}}">
												Delete Employee
											</a>
										</li>
									</ul>
								</div>

								<!-- DELETE EMPLOYEE MODAL -->
								<div class="modal fade" id="deleteEmployeeModal{{employee.id}}" tabindex="-1"
									aria-labelledby="deleteEmployeeModalLabel" aria-hidden="true">
									<div class="modal-dialog">
										<div class="modal-content">
											<div class="modal-header">
												<h5>Are you sure, want to delete {{ employee.username }}?</h5>
												<button type="button" class="btn-close" data-bs-dismiss="modal"
													aria-label="Close"></button>
											</div>
											<div class="modal-footer">
												<button class="btn btn-sm m-1 btn-dark">Cancel</button>
												<form
													action="{{ url_for('dashboard.delete_employee', employee_id=employee.id) }}"
													method="POST">
													<input type="submit" class="btn btn-danger btn-sm m-1"
														value="Yes, delete {{ employee.username }}" />
												</form>
											</div>
										</div>
									</div>
								</div>
							</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
			{% else %}
			<h5>
				No Employees added yet.
				<button type="button" class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal"
					data-bs-target="#employeeModal">
					<i class="bx bx-plus"></i>
					Add New Employee
				</button>
			</h5>
			{% endif %}

			{% else %}
			<div class="container my-3">
				<h1>You don't have permission to view this page ðŸ˜¥</h1>
				<h3>Only your shop owner can see this page ðŸ˜Ž</h3>
			</div>
			{% endif %}
		</main>
	</div>
</div>


<script>
	let error = document.querySelector('.invalid-feedback');
	let buttonaddproduct = document.querySelector(".btn.btn-sm.btn-outline-secondary")
	if (error) {
		alert('Product not saved. Something went wrong! Pleas and try again')
		document.addEventListener('DOMContentLoaded', () => {
			buttonaddproduct.click();
		})
	}
</script>

<script>
	let counter = 1;
	const serialnos = document.querySelectorAll('.counters');
	console.log(serialnos);
	serialnos.forEach(serial => {
		serial.innerText = counter;
		counter++;
	});
</script>
{% endblock %}